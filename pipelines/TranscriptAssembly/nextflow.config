manifest {
  name = 'TranscriptAssemblyHisat2Stringtie'
  author = 'Mahesh Binzer-Panchal'
  homePage = ''
  description = 'Nextflow Transcript assembly pipeline, using Hisat2 and Stringtie'
  mainScript = 'TranscriptAssemblyHisat2Stringtie.nf'
  nextflowVersion = '>=19.10.0'
  version = '0.2'
}

profiles {

  conda {
    process {
      withName: 'fastqc' {
        conda = "$baseDir/conda/process_fastqc.yml"
      }
      withName: 'trimmomatic' {
        conda = "$baseDir/conda/process_trimmomatic.yml"
      }
      withName: 'hisat2_index' {
        conda = "$baseDir/conda/process_hisat2.yml"
      }
      withName: 'hisat2' {
        conda = "$baseDir/conda/process_hisat2.yml"
      }
      withName: 'stringtie' {
        conda = "$baseDir/conda/process_stringtie.yml"
      }
      withName: 'multiqc' {
        conda = "$baseDir/conda/process_multiqc.yml"
      }
    }
  }

  debug { process.beforeScript = 'env' }
  docker {
    docker.enabled = true
    process {
      withName: 'fastqc' {
        container = 'quay.io/biocontainers/fastqc:0.11.8--2'
      }
      withName: 'trimmomatic' {
        container = 'quay.io/biocontainers/trimmomatic:0.39--1'
      }
      withName: 'hisat2_index' {
        // A combined container with hisat2=2.1.0,samtools=1.9
        container = 'quay.io/biocontainers/mulled-v2-a97e90b3b802d1da3d6958e0867610c718cb5eb1_20bc19483728f52659b6021b67af2d7fd07535d6'
        //container = 'quay.io/biocontainers/hisat2:2.1.0--py37hc9558a2_4'
      }
      withName: 'hisat2' {
        // A combined container with hisat2=2.1.0,samtools=1.9
        container = 'quay.io/biocontainers/mulled-v2-a97e90b3b802d1da3d6958e0867610c718cb5eb1_20bc19483728f52659b6021b67af2d7fd07535d6'
        // container = 'quay.io/biocontainers/hisat2:2.1.0--py37hc9558a2_4'
      }
      withName: 'stringtie' {
        container = 'quay.io/biocontainers/stringtie:2.0--hc900ff6_0'
      }
      withName: 'multiqc' {
        container = 'quay.io/biocontainers/multiqc:1.8--py_1'
      }
    }
  }

  singularity {
    singularity.enabled = true
    process {
      withName: 'fastqc' {
        container = 'quay.io/biocontainers/fastqc:0.11.8--2'
      }
      withName: 'trimmomatic' {
        container = 'quay.io/biocontainers/trimmomatic:0.39--1'
      }
      withName: 'hisat2_index' {
        // A combined container with hisat2=2.1.0,samtools=1.9
        container = 'quay.io/biocontainers/mulled-v2-a97e90b3b802d1da3d6958e0867610c718cb5eb1_20bc19483728f52659b6021b67af2d7fd07535d6'
        //container = 'quay.io/biocontainers/hisat2:2.1.0--py37hc9558a2_4'
      }
      withName: 'hisat2' {
        // A combined container with hisat2=2.1.0,samtools=1.9
        container = 'quay.io/biocontainers/mulled-v2-a97e90b3b802d1da3d6958e0867610c718cb5eb1_20bc19483728f52659b6021b67af2d7fd07535d6'
        // container = 'quay.io/biocontainers/hisat2:2.1.0--py37hc9558a2_4'
      }
      withName: 'stringtie' {
        container = 'quay.io/biocontainers/stringtie:2.0--hc900ff6_0'
      }
      withName: 'multiqc' {
        container = 'quay.io/biocontainers/multiqc:1.8--py_1'
      }
    }
  }

  nbis {
    executor {
      name = 'slurm'
    }
    process {
      cpus = 1
      maxForks = 20
      scratch = true
      shell = ['/bin/bash', '-euo', 'pipefail']
      stageOutMode = 'rsync'
      withName: fastqc {
        cpus = 2
      }
      withName: trimmomatic {
        cpus = 2
      }
      withName: hisat2_index {
        cpus = 4
      }
      withName: hisat2 {
        cpus = 8
      }
      withName: stringtie {
        cpus = 8
      }
    }
  }

  bils {
    executor {
      name = 'lsf'
    }
    process {
      cpus = 1
      maxForks = 20
      scratch = true
      shell = ['/bin/bash', '-euo', 'pipefail']
      stageOutMode = 'rsync'
      withName: fastqc {
        cpus = 2
      }
      withName: trimmomatic {
        cpus = 2
      }
      withName: hisat2_index {
        cpus = 4
      }
      withName: hisat2 {
        cpus = 8
      }
      withName: stringtie {
        cpus = 8
      }
    }
  }
}

resume = true

timeline {
  enabled = true
  file = "pipeline_report/execution_timeline.html"
}

report {
  enabled = true
  file = "pipeline_report/execution_report.html"
}

trace {
  enabled = true
  file = "pipeline_report/execution_trace.txt"
}

dag {
  enabled = true
  file = "pipeline_report/pipeline_dag.svg"
}
